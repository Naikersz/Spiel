# Инструкция по настройке автотейлинга в Godot 4

## Способ 1: Использование системы Terrain (рекомендуется для Godot 4)

### Шаг 1: Откройте TileSet в редакторе
1. В Godot откройте файл `tilesets/Sprite-0006-Sheet-Sheet-Sheet-Sheet-autotile.tres`
2. Или выберите TileMap в сцене и нажмите на кнопку "Edit TileSet" в инспекторе

### Шаг 2: Настройте источник тайлов
1. В нижней панели редактора TileSet найдите источник с ID **3** (SOURCE_ID_WALL)
2. Убедитесь, что текстура загружена правильно

### Шаг 3: Создайте Terrain
1. В нижней панели найдите вкладку **"Terrains"** (или "Террейны")
2. Нажмите кнопку **"Add Terrain Set"** (Добавить набор террейнов)
3. Назовите его, например, "Walls"

### Шаг 4: Добавьте Terrain в набор
1. В созданном наборе террейнов нажмите **"Add Terrain"**
2. Назовите террейн "Wall" или "Stone"

### Шаг 5: Настройте режим Terrain
1. Выберите созданный террейн
2. В инспекторе найдите параметр **"Mode"** (Режим)
3. Выберите **"Match corners and sides"** (Соответствие углам и сторонам)
   - Это эквивалент "Bitmask 3x3" из Godot 3

### Шаг 6: Назначьте террейн тайлам
1. Выберите тайлы в источнике (все 47 тайлов для автотейлинга)
2. В панели "Terrains" назначьте выбранный террейн этим тайлам
3. Godot автоматически определит битмаски на основе расположения тайлов в атласе

### Шаг 7: Настройте битмаски (если нужно)
1. Выберите каждый тайл в источнике
2. В инспекторе найдите раздел **"Terrain Peering Bits"** (Биты соединения террейна)
3. Убедитесь, что битмаски настроены правильно:
   - **Top-left corner** (Верхний левый угол)
   - **Top** (Верх)
   - **Top-right corner** (Верхний правый угол)
   - **Left** (Слева)
   - **Right** (Справа)
   - **Bottom-left corner** (Нижний левый угол)
   - **Bottom** (Низ)
   - **Bottom-right corner** (Нижний правый угол)

---

## Способ 2: Использование альтернативных тайлов (для совместимости)

Если у вас уже есть готовый набор из 47 тайлов, настроенный для автотейлинга:

### Шаг 1: Откройте TileSet
1. Откройте `tilesets/Sprite-0006-Sheet-Sheet-Sheet-Sheet-autotile.tres`

### Шаг 2: Настройте альтернативные тайлы
1. Выберите источник с ID 3
2. Выберите базовый тайл (обычно (0, 0))
3. В инспекторе найдите раздел **"Alternative Tiles"** (Альтернативные тайлы)
4. Добавьте альтернативные тайлы для каждого варианта автотейла (всего 47)

### Шаг 3: Настройте битмаски для каждого альтернативного тайла
1. Для каждого альтернативного тайла настройте **"Terrain Peering Bits"**
2. Это можно сделать вручную или использовать плагин

---

## Проверка настройки

После настройки проверьте:

1. **Источник с ID 3** должен иметь тип **TileSetAtlasSource**
2. **Terrain** должен быть настроен с режимом **"Match corners and sides"**
3. **Все тайлы** должны быть назначены на террейн
4. **Битмаски** должны быть правильно настроены

---

## Полезные плагины

Для упрощения настройки можно использовать:

1. **TileBitTools** - плагин с шаблонами автотейлинга
   - URL: https://godotengine.org/asset-library/asset/1757
   - Упрощает настройку битмасок

2. **Better Terrain** - расширенная система террейнов
   - URL: https://github.com/Portponky/better-terrain
   - Работает с существующими TileMap

---

## Структура 47-тайлового автотейла

Если ваше изображение содержит 47 тайлов, они должны быть расположены следующим образом:

```
Строка 0: 10 тайлов (0-9)
Строка 1: 10 тайлов (0-9)
Строка 2: 11 тайлов (0-10)
Строка 3: 11 тайлов (0-10)
Строка 4: 5 тайлов (4-8)
```

Итого: 10 + 10 + 11 + 11 + 5 = 47 тайлов

---

## Примечания

- В Godot 4 битмаски обновляются **автоматически** при использовании `set_cell()`
- Не нужно вызывать `update_bitmask_region()` - этого метода больше нет
- Убедитесь, что в коде используется правильный `SOURCE_ID_WALL` (в вашем случае это 3)
- Альтернативный тайл должен быть 0 для базового тайла автотейла

---

## Если автотейлинг не работает

1. Проверьте, что Terrain настроен правильно
2. Убедитесь, что все тайлы назначены на террейн
3. Проверьте, что битмаски настроены корректно
4. Убедитесь, что в коде используется правильный `SOURCE_ID_WALL`
5. Проверьте, что изображение содержит все необходимые тайлы в правильном порядке

